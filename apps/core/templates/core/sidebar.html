{% load chat %} 
{% load static %} 
{% if request.user.is_authenticated %}
<div class="sticky top-0 left-0 px-2 h-screen">
    <div class="flex flex-col justify-between h-screen">
        <div class="flex flex-col justify-center">
            <div class="flex py-1">
                <a class="flex justify-center font-semibold text-lg p-1 hover:bg-green-200 hover:rounded-full " href="{% url 'feed' %} ">
                    <div>
                        <i class="text-5xl fa-solid fa-ankh"></i>
                    </div>
                </a>
            </div>
            <div class="flex py-1">
                <a class="flex justify-center  font-semibold text-lg p-1 hover:bg-gray-200 dark:hover:bg-gray-700 hover:rounded-full " href="{% url 'feed' %} ">
                    <div>
                        <i class="w-10 text-lg py-2 fa-solid  fa-house"></i>
                    </div>
                    <span class="m-auto mx-3">Página Inicial</span>
                </a>
            </div>
            <div class="flex py-1">
                <a class="flex  font-semibold text-lg p-1 hover:bg-gray-200 dark:hover:bg-gray-700 hover:rounded-full " href="{% url 'notifications' %} ">
                    <div>
                        <i class="w-10 text-lg py-2 fa-solid fa-bell"></i>
                    </div>
                    <span id="notifications" class="m-auto mx-3">Notificações</span>
                </a>
            </div>
            <div class="flex py-1">
                <a class="flex  font-semibold text-lg p-1 hover:bg-gray-200 dark:hover:bg-gray-700 hover:rounded-full " href="{% url 'users' %} ">
                    <div>
                        <i class="w-10 text-lg py-2 fa-solid fa-users"></i>
                    </div>
                    <span class="m-auto mx-3">All users</span>
                </a>
            </div>
            <div class="flex py-1">
                <a class="flex  font-semibold text-lg p-1 hover:bg-gray-200 dark:hover:bg-gray-700 hover:rounded-full " href="{% url 'global' %} ">
                    <div>
                        <i class="w-10 text-lg py-2 fa-solid fa-earth-americas"></i>
                    </div>
                    <span class="break-keep m-auto mx-3">Global chat</span>
                </a>
            </div>
            <div class="flex py-1">
                <a class="flex  font-semibold text-lg p-1 hover:bg-gray-200 dark:hover:bg-gray-700 hover:rounded-full " href="{% url 'conversations' %} ">
                    <div>
                        <i class="w-10 text-lg py-2 fa-solid fa-comments"></i>
                    </div>
                    <span class="m-auto mx-3">Conversations</span>
                </a>
            </div>
            <div class="flex py-1">
                <a class="flex  font-semibold text-lg p-1 hover:bg-gray-200 dark:hover:bg-gray-700 hover:rounded-full " href="{% url 'twikkerprofile' request.user.username %} ">
                    <div>
                        <i class="w-10 text-lg py-2 fa-solid fa-user"></i>
                    </div>
                    <span class="m-auto mx-3">Perfil</span>
                </a>
            </div>
            <div class="flex py-1">
                <a class="flex font-semibold text-lg p-1 hover:bg-gray-200 dark:hover:bg-gray-700 hover:rounded-full" onclick="toggleDarkMode()">
                    <div>
                        <i class="text-xl py-2 fa-solid fa-moon"></i>
                    </div>
                </a>
            </div>
        </div>
    </div>
</div>
{% else %}
    <div>
        <div>
            <div>
                <a href="{% url 'signup' %} ">Sign Up</a>
                <a href="{% url 'login' %} ">Log in</a>
            </div>
        </div>
    </div>
{% endif %} 
{% block script %}
    <script>
    function toggleDarkMode() {
        var element = document.body;
        element.classList.toggle("dark");
        fetch("{% url 'darkmode' %}", {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                'user_id': '{{ request.user.id }}',
            })
        })
    }
    </script>
    <script>
        {#const notificationSocket = new WebSocket(#}
        {#    'ws://' +#}
        {#    window.location.host +#}
        {#    '/ws/' +#}
        {#    'notifications/'#}
        {#);#}

        {% if conversation %} {% get_chat_user_id conversation request.user.id as userid %} {% endif %}

        const chatSocket = new WebSocket(
            'ws://' +
            window.location.host +
            '/ws/' +
            'chat/' +
            '{% if conversation %}{{ userid }}{% else %}0{% endif %}' +
            '/'
        );

        chatSocket.onmessage = function(e) {
            const data = JSON.parse(e.data);
            console.log("datza", data);
            conversationapp.messages.push(data);
            setTimeout(() => {
                scrollToBottom();
            }, 0);
        };

        {#notificationSocket.onmessage = function(e) {#}
        {#    notifications_el = document.querySelector('#notifications').innerHTML#}
        {#    notification_count = parseInt(notifications_el.split('(')[1].split(')')[0])#}
        {#    document.querySelector('#notifications').innerHTML = '<span class="white ">Notifications (' + (notification_count + 1) + ')</span>'#}

    </script>
{% endblock %}