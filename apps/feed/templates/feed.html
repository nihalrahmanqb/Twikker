{% extends 'core/base.html' %}
{% block content %}
<div class="flex flex-row w-full max-w-5xl justify-between">

  <div id="feedapp" class="flex max-w-2xl flex-col bg-white border-solid border-r-2 border-gray-100">
    
    <div class="sticky p-3 bg-white top-0 w-full h-fit text-2xl"><a href="{% url 'feed' %}">Pagina inicial</a></div>
    <div class="flex h-30 w-full p-2 border-solid border-b-2 border-gray-100">
      <div class="flex h-full pt-1 mr-3">
        <img class="rounded-full h-12 w-12" src="{% if request.user.twikkerprofile.avatar %}{{ request.user.twikkerprofile.avatar.url }}{% endif %}">
      </div>
        <div class="flex flex-col w-full ">
          <div class="flex w-full py-5">
          <textarea placeholder="What you tweeking bro..." class="text-xl resize-none h-fit w-full  outline-none" type="text"></textarea>
          </div>
          <div class="flex border-solid border-t-2 border-gray-100 w-full">
            <div class="flex my-4 w-full">
              <div class="flex justify-between w-full">
                <div class="flex">
                  <button class=""><i class="fa-regular fa-image"></i></button>
                </div>
                <div class="flex">
                  <button class="bg-green-300 rounded-lg mx-3 px-10 shadow-md"><span class="">Enter</span></button>
                </div>
              </div>
            </div>
          </div>
        </div>
    </div>
    <div v-for="tweek in tweeks" v-bind:key="tweek.id" class="flex flex-rol h-fit w-full p-2 border-solid border-b-2 hover:bg-gray-100 border-gray-100"> 
          <div class="flex mr-2">
            <img class="rounded-full h-12 w-12" :src="tweek.avatar_url" width="500">
          </div>
        <div class="flex flex-col w-full">
          <span class="align-top">
            [[ tweek.tweeker_name ]] 
          </span>
          <span class="flex text-xl break-all"> [[ tweek.body ]] </span>
          <div class="flex flex-row justify-between w-2/3 mt-3">
            <div class="flex">
              <div class="w-8 h-8 p-1 text-center hover:bg-yellow-200 hover:rounded-full">
                <i class="fa-regular fa-comment-dots"></i>
              </div>
              <span class="pt-1">250</span>
            </div>
            <div class="flex">
              <div class="w-8 h-8 p-1 text-center hover:bg-blue-300 hover:rounded-full">
                <i class="fa-solid fa-retweet"></i>
              </div>
              <span class="pt-1">25</span>
            </div>
            <div class="flex">
              <div class="flex mx-2">
                <div class="w-8 h-8 p-1 text-center hover:bg-green-200 hover:rounded-full">
                <i class="fa-regular fa-thumbs-up"></i>
                </div>
                <span class="pt-1">100</span>
              </div>
              <div class="flex mx-2">
                <div class="w-8 h-8 p-1 text-center hover:bg-red-300 hover:rounded-full">
                <i class="fa-regular fa-thumbs-down"></i>
                </div>
                <span class="pt-1">9</span>
              </div>
            </div>
          </div>  
        </div>
    </div>
  </div>

  <div class="h-full place-self-end ml-4">
    <div class="place-content-end bg-gray-100 rounded-xl w-72 h-72 shadow-sm">Salves</div>
  </div>
</div>
{% endblock %}

{% block script %}
<script>
  document.body.addEventListener('keydown', function(e) {
      if(!(e.keyCode == 13 && (e.metaKey || e.ctrlKey))) return;
            var target = e.target;
            submit_button = document.querySelector('#submit-tweet');
            if(target.form) {
                submit_button.click();
          }
      });
</script>
<script>
</script>

<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp } = Vue

  createApp({
    delimiters: ['[[', ']]'],
    data() {
      return {
        count: 0,
          tweeks: [],
          body: '',
          currentPage: 1,
          tweeker: '{{ request.user.username }}',
          created_at: 'Now',
          avatar: '{% if request.user.twikkerprofile.avatar %}{{ request.user.twikkerprofile.avatar.url }}{% endif %}',
          liked_tweeks: [{% for tweek in tweeks %}{% if tweek.liked %}{{ tweek.id }},{% endif %}{% endfor %}],
      }
    },
    mounted(){
    this.getTweeks()
    window.onscroll = () => {
        let bottomOfWindow = document.documentElement.scrollTop + window.innerHeight === document.documentElement.offsetHeight

        if (bottomOfWindow && this.hasNext) {
            this.currentPage += 1
            this.getTweeks()
        }
    }
    },
    methods:{
      getTweeks() {
      console.log('Get Posts')
      fetch(`/api/get_tweeks/?page=${this.currentPage}`)
          .then(response => {
              return response.json()
          })
          .then(data => {
              console.log(data)

              this.hasNext = false

              if (data.next) {
                  this.hasNext = true
              }
              for (let i = 0; i < data.results.length; i++) {
                  this.tweeks.push(data.results[i])
              }
          })
          .catch(error => {
              console.log(error)
          })
      },
    }
  }).mount('#feedapp')
</script>
{% endblock %}