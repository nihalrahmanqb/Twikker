{% extends 'core/base.html' %}
{% block content %}
<div class="grid gap-8 grid-flow-col">
  <main class="flex flex-col bg-white border-solid border-r-2 border-gray-100" id="feedapp" style="width: 600px;">

    <div class="p-2 border-solid border-b-2 border-gray-100"> 
      <div class="flex">
        <div class="static flex w-fit mr-2">
          <div class="bg-gray-500 rounded-full h-6 w-6"></div>
        </div>
        <span class="inline-block align-top">
          Denis Gustavo
        </span>
      </div>
      <span class="flex text-xl ml-8">Qualquer bosta Tweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweetTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grande grandeTweet maior teste tweet grande</span>
    </div>

    <div class="p-2 border-solid border-b-2 border-gray-100"> 
      <div class="flex">
        <div class="static flex w-fit mr-2">
          <div class="bg-gray-500 rounded-full h-6 w-6"></div>
        </div>
        <span class="inline-block align-top">
          Denis Gustavo
        </span>
      </div>
      <span class="flex text-xl ml-8">Qualquer bosta Tweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweetTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grande grandeTweet maior teste tweet grande</span>
    </div>

    <div class="p-2 border-solid border-b-2 border-gray-100"> 
      <div class="flex">
        <div class="static flex w-fit mr-2">
          <div class="bg-gray-500 rounded-full h-6 w-6"></div>
        </div>
        <span class="inline-block align-top">
          Denis Gustavo
        </span>
      </div>
      <span class="flex text-xl ml-8">Qualquer bosta Tweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweetTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grande grandeTweet maior teste tweet grande</span>
    </div>

    <div class="p-2 border-solid border-b-2 border-gray-100"> 
      <div class="flex">
        <div class="static flex w-fit mr-2">
          <div class="bg-gray-500 rounded-full h-6 w-6"></div>
        </div>
        <span class="inline-block align-top">
          Denis Gustavo
        </span>
      </div>
      <span class="flex text-xl ml-8">Qualquer bosta Tweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweetTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grande grandeTweet maior teste tweet grande</span>
    </div>

    <div class="p-2 border-solid border-b-2 border-gray-100"> 
      <div class="flex">
        <div class="static flex w-fit mr-2">
          <div class="bg-gray-500 rounded-full h-6 w-6"></div>
        </div>
        <span class="inline-block align-top">
          Denis Gustavo
        </span>
      </div>
      <span class="flex text-xl ml-8">Qualquer bosta Tweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweetTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grande grandeTweet maior teste tweet grande</span>
    </div>

    <div class="static p-2 border-solid border-b-2 border-gray-100"> 
      <div class="flex">
        <div class="w-fit mr-2">
          <div class="bg-gray-500 rounded-full h-6 w-6"></div>
        </div>
        <span>
          Denis Gustavo
        </span>
      </div>
      <span class="flex text-xl ml-8">Alguma coisa</span>
    </div>

    <div class="p-2 border-solid border-b-2 border-gray-100"> 
      <div class="flex">
        <div class="static flex w-fit mr-2">
          <div class="bg-gray-500 rounded-full h-6 w-6"></div>
        </div>
        <span class="inline-block align-top">
          Denis Gustavo
        </span>
      </div>
      <span class="flex text-xl ml-8">Qualquer bosta Tweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweetTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grande grandeTweet maior teste tweet grande</span>
    </div>
    

    <div class="p-2 border-solid border-b-2 border-gray-100"> 
      <div class="flex">
        <div class="static flex w-fit mr-2">
          <div class="bg-gray-500 rounded-full h-6 w-6"></div>
        </div>
        <span class="inline-block align-top">
          Denis Gustavo
        </span>
      </div>
      <span class="flex text-xl ml-8">Qualquer bosta Tweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweetTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grande grandeTweet maior teste tweet grande</span>
    </div>

    <div class="p-2 border-solid border-b-2 border-gray-100"> 
      <div class="flex">
        <div class="static flex w-fit mr-2">
          <div class="bg-gray-500 rounded-full h-6 w-6"></div>
        </div>
        <span class="inline-block align-top">
          Denis Gustavo
        </span>
      </div>
      <span class="flex text-xl ml-8">Qualquer bosta Tweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweetTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grandeTweet maior teste tweet grande grandeTweet maior teste tweet grande</span>
    </div>

  </main>
  <div class="h-full place-self-end">
    <div class="place-content-end bg-gray-100 rounded w-72 h-72">Salves</div>
  </div>
</div>
{% endblock %}

{% block script %}
<script>

    document.body.addEventListener('keydown', function(e) {
	if(!(e.keyCode == 13 && (e.metaKey || e.ctrlKey))) return;
        var target = e.target;
        submit_button = document.querySelector('#submit-tweet');
        if(target.form) {
            submit_button.click();
        }
    });

    new Vue({
        el: '#feedapp',
        delimiters: ['[[', ']]'],
        data(){
            return{
                tweeks: [],
                body: '',
                tweeker: '{{ request.user.username }}',
                created_at: 'Now',
                avatar: '{% if request.user.twikkerprofile.avatar %}{{ request.user.twikkerprofile.avatar.url }}{% endif %}',
                liked_tweeks: [{% for tweek in tweeks %}{% if tweek.liked %}{{ tweek.id }},{% endif %}{% endfor %}],
            }
        },
        methods: {
            toggleLike(tweek_id){
                if(this.liked_tweeks.includes(tweek_id)){
                    this.dislikeTweek(tweek_id);
                }else{
                    this.likeTweek(tweek_id);
                }
            },
            async likeTweek(tweek_id){
                this.liked_tweeks.push(parseInt(tweek_id));

                likeSocket.send(JSON.stringify({
                    'tweek_id': tweek_id,
                    'liker': '{{ request.user.username }}',
                }));

                const el = document.getElementById('likes-' + tweek_id);
                const likes = parseInt(el.innerHTML) + 1;
                el.innerHTML = likes + ' likes';
            },
            dislikeTweek(tweek_id){
                this.liked_tweeks = this.liked_tweeks.filter(item => item !== tweek_id)
                var tweek = {
                    'tweek_id': tweek_id,
                };

                fetch('/api/remove_like/',{
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}',
                        },
                        credentials: 'same-origin',
                        body: JSON.stringify(tweek)
                    })
                    .then((response) => {
                        console.log(response);
                    })
                    .catch((error) => {
                        console.log(error);
                    });

                    const el = document.getElementById('likes-' + tweek_id);
                    const likes = parseInt(el.innerHTML) - 1;
                    console.log(likes);
                    el.innerHTML = likes + ' likes';
            },
            deleteTweek(tweek_id){
                var tweek = {
                    'tweek_id': tweek_id,
                };
                fetch('/api/delete_tweek/',{
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}',
                        },
                        credentials: 'same-origin',
                        body: JSON.stringify(tweek)
                    })
                    .then((response) => {
                        console.log(response);
                    })
                    .catch((error) => {
                        console.log(error);
                    });

                    const el = document.getElementById('tweek-' + tweek_id);
                    el.remove();
            },
            async submitTweek(){
                if (this.body.length > 0){
                    let tweek = {
                        'body': this.body,
                        'tweeker': this.tweeker,
                        'created_at': this.created_at,
                        'avatar': this.avatar
                    };

                    // Send to backend
                    tweekSocket.send(JSON.stringify(tweek));
                    this.tweeks.unshift(tweek);
                }
                this.body = '';
                console.log('twweeks' + this.tweeks);
            }
        }
    })
</script>
{% endblock %}