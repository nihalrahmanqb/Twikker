{% extends 'core/base.html' %}
{% load json_script %}
{% load static %}
{% block content %}
<div class="flex min-w-full">
    <div id="feedapp" class="flex flex-col w-full border-solid border-x-2 border-gray-100 dark:border-gray-700 max-[600px]:border-x-0">
        <div class="min-[600px]:sticky p-3 bg-white dark:bg-slate-900 top-0 min-[600px]:opacity-90 w-full h-fit text-2xl border-b-2 border-gray-700">
            <a href="{% url 'feed' %}">
                <span class="opacity-100 font-semibold">PÃ¡gina inicial</span>
            </a>
        </div>
        <div class="flex h-30 w-full pt-3 pl-3 border-solid border-b-2 border-gray-100 dark:border-gray-700">
            <div class="flex w-14 h-full pt-1">
                <img class="rounded-full h-12 w-12" src="{% if request.user.twikkerprofile.avatar %}{{ request.user.twikkerprofile.avatar.url }}{% endif %}">
            </div>
            <div class="flex flex-col w-full pl-1">
                <form v-on:submit.prevent="submitTweek()">
                    <div class="flex w-full py-5">
                        <textarea placeholder="What you tweeking bro..." class="text-xl resize-none h-fit w-full outline-none bg-white dark:bg-slate-900" type="text" v-model="body"></textarea>
                    </div>
                    <div class="flex border-solid border-t-2 border-gray-100 dark:border-gray-700 w-full">
                        <div class="flex my-2 w-full">
                            <div class="flex justify-between w-full">
                                <div class="flex">
                                    <button class=""><i class="p-1 fa-regular fa-image"></i></button>
                                </div>
                                <div class="flex m-1">
                                    <button id="submit-tweet" type="submit" class="bg-green-400 rounded-full text-white font-bold mx-3 px-5 py-2">Submit</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
            <div v-for="tweek in tweeks" v-bind:key="tweek.id" class="flex h-fit w-full px-3 border-solid border-b-2 hover:bg-gray-100 dark:hover:bg-gray-700 border-gray-100 dark:border-gray-700">
{#                <a href="#" @click="viewTweek(tweek.id)">#}
                <div class="flex flex-col w-full m-1">
                    <div v-if="tweek.retweek" class="flex items-center mb-1">
                        <i class="text-blue-600 fa-solid fa-retweet mr-2"></i>
                        <span class="flex font-semibold"> [[ tweek.tweeker_name + ' compartilhou']]</span>
                    </div>
                    <div v-else class="flex h-3"></div>
                    <div class="flex">
                        <div class="flex w-14 h-full pr-2">
                            <img class="rounded-full h-12 w-12" :src="tweek.retweek ? tweek.retweek_avatar_url : tweek.avatar_url">
                        </div>
                        <div class="flex flex-col w-full pb-1">
                            <div>
                                <span class="font-semibold text-lg">
                                    [[ tweek.retweek ? tweek.retweek_tweeker_name : tweek.tweeker_name ]]
                                </span>
                                <span class="ml-2">
                                    [[ tweek.retweek ? tweek.retweek_formatted_time : tweek.formatted_time ]]
                                </span>
                            </div>
                            <span class="flex text-xl break-all">[[ tweek.retweek ? tweek.retweek_body : tweek.body ]]</span>
                            <div v-if="!tweek.retweek" class="flex flex-row justify-between w-2/3 mt-3">
                                <div class="flex">
                                    <div class="w-8 h-8 p-1 text-center hover:bg-yellow-200 hover:rounded-full">
                                        <i class="fa-regular fa-comment-dots"></i>
                                    </div>
                                    <span class="pt-1"></span>
                                </div>
                                <div class="flex">
                                    <div @click.stop="toggleRetweek(tweek.id)" class="w-8 h-8 p-1 text-center hover:bg-blue-300 hover:rounded-full">
                                        <i :id="'retweek-'+tweek.id" :class=" this.retweeked_tweeks.includes(tweek.id) ? 'text-blue-600 fa-solid fa-retweet' : 'fa-solid fa-retweet'"></i>
                                    </div>
                                    <span class="pt-1">[[ tweek.retweek_count ]]</span>
                                </div>
                                <div class="flex">
                                    <div class="flex mx-2">
                                        <div @click.stop="toggleLike(tweek)" class="w-8 h-8 p-1 text-center hover:bg-green-200 hover:rounded-full">
                                            <i :id="'like-'+tweek.id" :class=" !tweek.is_liked ? 'fa-regular fa-thumbs-up' : 'fa-solid fa-thumbs-up' "></i>
                                        </div>
                                        <span :id="'likes-'+tweek.id" class="pt-1">[[ tweek.likes_count ]]</span>
                                    </div>
                                    <div class="flex mx-2">
                                        <div @click.stop="toggleDislike(tweek)" class="w-8 h-8 p-1 text-center hover:bg-red-200 hover:rounded-full">
                                            <i :id="'dislike-'+tweek.id" :class=" !tweek.is_disliked ? 'fa-regular fa-thumbs-down' : 'fa-solid fa-thumbs-down' "></i>
                                        </div>
                                        <span :id="'dislikes-'+tweek.id" class="pt-1">[[ tweek.dislikes_count ]]</span>
                                    </div>
                                </div>
                            </div>
                            <div v-if="tweek.retweek">
                                <a href="#"><p class="text-md mt-2 text-blue-300 w-fit hover:text-blue-100 rounded-xl">Ver tweek original</p></a>
                            </div>
                        </div>
                    </div>
                </div>
{#                </a>#}
            </div>
    </div>
</div>
{% endblock %} 
{% block script %}

{% json_script "tweeker_username" request.user.username %}
{% json_script "liked_tweeks" liked_tweeks|safe %}
{% json_script "disliked_tweeks" disliked_tweeks|safe %}
{% json_script "retweeked_tweeks" retweeked_tweeks|safe %}

{% if request.user.twikkerprofile.avatar %}
    {% json_script "tweeker_avatar" request.user.twikkerprofile.avatar.url %}
{% endif %}

<script type="module" src="{% static 'js/feed.mjs' %}"></script>

{% endblock %}